# JShell Examples for External Data Service\n\nThis document provides JShell examples demonstrating how to use the external data service interactively.\n\n## Starting JShell with DMV Context\n\nStart the application with JShell integration:\n\n```bash\njava -jar dmv-rules-engine.jar --jshell\n```\n\nOr use the web-based JShell interface at: http://localhost:8080/jshell\n\n## Basic Setup in JShell\n\n```java\n// Import necessary classes\nimport com.dmv.service.*;\nimport com.dmv.model.*;\nimport java.util.*;\n\n// Get the external data service from Spring context\nExternalDataService externalDataService = applicationContext.getBean(ExternalDataService.class);\nExternalDataHelper dataHelper = applicationContext.getBean(ExternalDataHelper.class);\n\n// Check available collections\nSet<String> collections = externalDataService.getAvailableCollections();\nSystem.out.println(\"Available collections: \" + collections);\n```\n\n## Exploring State Data\n\n```java\n// Get all states\nList<Map<String, Object>> allStates = externalDataService.findByCollection(\"states\");\nSystem.out.println(\"Total states: \" + allStates.size());\n\n// Get specific state by code\nOptional<Map<String, Object>> california = dataHelper.getStateByCode(\"CA\");\nif (california.isPresent()) {\n    System.out.println(\"California info: \" + california.get());\n}\n\n// Check online renewal availability\nboolean caOnline = dataHelper.isOnlineRenewalAvailable(\"CA\");\nboolean nyOnline = dataHelper.isOnlineRenewalAvailable(\"NY\");\nboolean txOnline = dataHelper.isOnlineRenewalAvailable(\"TX\");\n\nSystem.out.println(\"Online renewal availability:\");\nSystem.out.println(\"CA: \" + caOnline);\nSystem.out.println(\"NY: \" + nyOnline);\nSystem.out.println(\"TX: \" + txOnline);\n\n// Get late fees by state\nSystem.out.println(\"\\nLate fees by state:\");\nfor (String state : Arrays.asList(\"CA\", \"NY\", \"TX\", \"FL\")) {\n    double lateFee = dataHelper.getLateFee(state);\n    System.out.println(state + \": $\" + lateFee);\n}\n\n// Find states by region\nList<Map<String, Object>> westStates = externalDataService.findByCollectionAndKey(\"states\", \"region\", \"West\");\nSystem.out.println(\"\\nWest region states:\");\nwestStates.forEach(state -> System.out.println(\"  \" + state.get(\"name\")));\n```\n\n## Exploring License Class Data\n\n```java\n// Get all license classes\nList<Map<String, Object>> allClasses = externalDataService.findByCollection(\"license-classes\");\nSystem.out.println(\"Available license classes:\");\nallClasses.forEach(cls -> System.out.println(\"  \" + cls.get(\"class\") + \": \" + cls.get(\"name\")));\n\n// Check specific license class requirements\nOptional<Map<String, Object>> motorcycleClass = dataHelper.getLicenseClassByCode(\"MOTORCYCLE\");\nif (motorcycleClass.isPresent()) {\n    System.out.println(\"\\nMotorcycle license details:\");\n    System.out.println(\"  Name: \" + motorcycleClass.get().get(\"name\"));\n    System.out.println(\"  Min Age: \" + motorcycleClass.get().get(\"minAge\"));\n    System.out.println(\"  Renewal Fee: $\" + motorcycleClass.get().get(\"renewalFee\"));\n    System.out.println(\"  Requires Driving Test: \" + dataHelper.requiresDrivingTest(\"MOTORCYCLE\"));\n}\n\n// Compare minimum ages across license classes\nSystem.out.println(\"\\nMinimum ages by license class:\");\nfor (String classCode : Arrays.asList(\"LEARNER_PERMIT\", \"CLASS_C\", \"MOTORCYCLE\", \"CDL_A\")) {\n    int minAge = dataHelper.getMinimumAge(classCode);\n    System.out.println(\"  \" + classCode + \": \" + minAge + \" years\");\n}\n\n// Check test requirements\nSystem.out.println(\"\\nDriving test requirements:\");\nfor (String classCode : Arrays.asList(\"LEARNER_PERMIT\", \"CLASS_C\", \"MOTORCYCLE\", \"CDL_A\")) {\n    boolean testRequired = dataHelper.requiresDrivingTest(classCode);\n    System.out.println(\"  \" + classCode + \": \" + (testRequired ? \"Required\" : \"Not required\"));\n}\n```\n\n## Exploring Fee Schedules\n\n```java\n// Get all fee schedules\nList<Map<String, Object>> allFees = externalDataService.findByCollection(\"fee-schedules\");\nSystem.out.println(\"Available fee types:\");\nallFees.forEach(fee -> System.out.println(\"  \" + fee.get(\"type\") + \" (\" + fee.get(\"category\") + \"): $\" + fee.get(\"baseAmount\")));\n\n// Get renewal fees\nList<Map<String, Object>> renewalFees = dataHelper.getFeeSchedulesByType(\"renewal\");\nSystem.out.println(\"\\nRenewal fee schedules:\");\nrenewalFees.forEach(fee -> {\n    System.out.println(\"  \" + fee.get(\"category\") + \": $\" + fee.get(\"baseAmount\"));\n    Map<String, Object> modifiers = (Map<String, Object>) fee.get(\"modifiers\");\n    if (modifiers != null) {\n        System.out.println(\"    Modifiers: \" + modifiers);\n    }\n});\n\n// Calculate fees with discounts\nOptional<Map<String, Object>> standardRenewal = dataHelper.getFeeSchedule(\"renewal\", \"standard\");\nif (standardRenewal.isPresent()) {\n    Map<String, Object> modifiers = (Map<String, Object>) standardRenewal.get().get(\"modifiers\");\n    double baseAmount = (Double) standardRenewal.get().get(\"baseAmount\");\n    \n    System.out.println(\"\\nFee calculations for standard renewal (base: $\" + baseAmount + \"):\");\n    \n    // Senior discount\n    List<String> seniorModifiers = Arrays.asList(\"senior_discount\");\n    double seniorFee = dataHelper.calculateTotalFee(baseAmount, modifiers, seniorModifiers);\n    System.out.println(\"  With senior discount: $\" + seniorFee);\n    \n    // Veteran discount\n    List<String> veteranModifiers = Arrays.asList(\"veteran_discount\");\n    double veteranFee = dataHelper.calculateTotalFee(baseAmount, modifiers, veteranModifiers);\n    System.out.println(\"  With veteran discount: $\" + veteranFee);\n    \n    // Expedited processing\n    List<String> expeditedModifiers = Arrays.asList(\"expedited_processing\");\n    double expeditedFee = dataHelper.calculateTotalFee(baseAmount, modifiers, expeditedModifiers);\n    System.out.println(\"  With expedited processing: $\" + expeditedFee);\n    \n    // Combined discounts (senior + veteran)\n    List<String> combinedModifiers = Arrays.asList(\"senior_discount\", \"veteran_discount\");\n    double combinedFee = dataHelper.calculateTotalFee(baseAmount, modifiers, combinedModifiers);\n    System.out.println(\"  With senior + veteran discount: $\" + combinedFee);\n}\n```\n\n## Testing Cache Performance\n\n```java\n// Test cache performance\nlong startTime, endTime;\n\n// First access (cache miss)\nstartTime = System.currentTimeMillis();\nList<Map<String, Object>> states1 = externalDataService.findByCollection(\"states\");\nendTime = System.currentTimeMillis();\nSystem.out.println(\"First access (cache miss): \" + (endTime - startTime) + \"ms\");\n\n// Second access (cache hit)\nstartTime = System.currentTimeMillis();\nList<Map<String, Object>> states2 = externalDataService.findByCollection(\"states\");\nendTime = System.currentTimeMillis();\nSystem.out.println(\"Second access (cache hit): \" + (endTime - startTime) + \"ms\");\n\n// Get cache statistics\nCacheStatistics stats = externalDataService.getCacheStatistics();\nSystem.out.println(\"\\nCache Statistics:\");\nSystem.out.println(\"  Total hits: \" + stats.getTotalHits());\nSystem.out.println(\"  Total misses: \" + stats.getTotalMisses());\nSystem.out.println(\"  Hit ratio: \" + String.format(\"%.2f%%\", stats.getOverallHitRatio() * 100));\nSystem.out.println(\"  Total size: \" + stats.getTotalSize());\nSystem.out.println(\"  Utilization: \" + String.format(\"%.2f%%\", stats.getOverallUtilization() * 100));\n```\n\n## Cache Management\n\n```java\n// Warm up cache for better performance\nexternalDataService.warmUpCache(\"states\");\nexternalDataService.warmUpCache(\"license-classes\");\nexternalDataService.warmUpCache(\"fee-schedules\");\n\nSystem.out.println(\"Cache warmed up for all collections\");\n\n// Check cache statistics after warm-up\nCacheStatistics warmStats = externalDataService.getCacheStatistics();\nSystem.out.println(\"\\nCache Statistics after warm-up:\");\nSystem.out.println(\"  Total size: \" + warmStats.getTotalSize());\nSystem.out.println(\"  Utilization: \" + String.format(\"%.2f%%\", warmStats.getOverallUtilization() * 100));\n\n// Invalidate specific collection cache\nexternalDataService.invalidateCache(\"states\");\nSystem.out.println(\"\\nInvalidated states cache\");\n\n// Test access after invalidation\nstartTime = System.currentTimeMillis();\nList<Map<String, Object>> statesAfterInvalidation = externalDataService.findByCollection(\"states\");\nendTime = System.currentTimeMillis();\nSystem.out.println(\"Access after invalidation: \" + (endTime - startTime) + \"ms\");\n```\n\n## Creating Test Scenarios\n\n```java\n// Create sample license renewal requests for testing\nPersonalInfo person1 = new PersonalInfo();\nperson1.setFirstName(\"John\");\nperson1.setLastName(\"Doe\");\nperson1.setAge(67); // Senior citizen\nperson1.setVeteranStatus(true);\n\nAddress address1 = new Address();\naddress1.setState(\"CA\");\naddress1.setCity(\"Los Angeles\");\naddress1.setZipCode(\"90210\");\nperson1.setAddress(address1);\n\nLicenseInfo license1 = new LicenseInfo();\nlicense1.setLicenseClass(LicenseClass.CLASS_C);\nlicense1.setExpired(false);\nlicense1.setMonthsSinceExpiration(0);\n\nLicenseRenewalRequest request1 = new LicenseRenewalRequest();\nrequest1.setPersonalInfo(person1);\nrequest1.setCurrentLicense(license1);\n\nSystem.out.println(\"Created test request for senior veteran in CA\");\n\n// Test data lookups for this scenario\nSystem.out.println(\"\\nData lookups for test scenario:\");\nSystem.out.println(\"State: \" + dataHelper.getStateByCode(\"CA\").get().get(\"name\"));\nSystem.out.println(\"Online renewal available: \" + dataHelper.isOnlineRenewalAvailable(\"CA\"));\nSystem.out.println(\"License class min age: \" + dataHelper.getMinimumAge(\"CLASS_C\"));\nSystem.out.println(\"Base renewal fee: $\" + dataHelper.getRenewalFee(\"CLASS_C\"));\nSystem.out.println(\"Driving test required: \" + dataHelper.requiresDrivingTest(\"CLASS_C\"));\n\n// Calculate expected fee with discounts\nOptional<Map<String, Object>> feeSchedule = dataHelper.getFeeSchedule(\"renewal\", \"standard\");\nif (feeSchedule.isPresent()) {\n    Map<String, Object> modifiers = (Map<String, Object>) feeSchedule.get().get(\"modifiers\");\n    double baseAmount = (Double) feeSchedule.get().get(\"baseAmount\");\n    \n    List<String> applicableModifiers = Arrays.asList(\"senior_discount\", \"veteran_discount\");\n    double totalFee = dataHelper.calculateTotalFee(baseAmount, modifiers, applicableModifiers);\n    \n    System.out.println(\"Expected total fee with discounts: $\" + totalFee);\n}\n```\n\n## Advanced Queries\n\n```java\n// Find all states that require tests\nList<Map<String, Object>> testRequiredStates = externalDataService.findByCollectionAndKey(\"states\", \"dmv.testRequired\", true);\nSystem.out.println(\"\\nStates requiring tests:\");\ntestRequiredStates.forEach(state -> System.out.println(\"  \" + state.get(\"name\")));\n\n// Find license classes with restrictions\nList<Map<String, Object>> restrictedClasses = externalDataService.findByCollectionAndKeyExists(\"license-classes\", \"restrictions\");\nSystem.out.println(\"\\nLicense classes with restrictions:\");\nrestrictedClasses.forEach(cls -> {\n    System.out.println(\"  \" + cls.get(\"name\"));\n    List<String> restrictions = (List<String>) cls.get(\"restrictions\");\n    if (restrictions != null && !restrictions.isEmpty()) {\n        restrictions.forEach(restriction -> System.out.println(\"    - \" + restriction));\n    }\n});\n\n// Find all fees applicable to motorcycle licenses\nList<Map<String, Object>> motorcycleFees = externalDataService.findByCollectionAndKey(\"fee-schedules\", \"applicableTo\", \"MOTORCYCLE\");\nSystem.out.println(\"\\nFees applicable to motorcycle licenses:\");\nmotorcycleFees.forEach(fee -> {\n    System.out.println(\"  \" + fee.get(\"type\") + \" (\" + fee.get(\"category\") + \"): $\" + fee.get(\"baseAmount\"));\n    System.out.println(\"    \" + fee.get(\"description\"));\n});\n```\n\n## Performance Testing\n\n```java\n// Performance test with multiple concurrent accesses\nimport java.util.concurrent.*;\n\nExecutorService executor = Executors.newFixedThreadPool(10);\nList<Future<Long>> futures = new ArrayList<>();\n\n// Submit 100 concurrent requests\nfor (int i = 0; i < 100; i++) {\n    final int requestId = i;\n    Future<Long> future = executor.submit(() -> {\n        long start = System.currentTimeMillis();\n        \n        // Mix of different query types\n        if (requestId % 3 == 0) {\n            externalDataService.findByCollection(\"states\");\n        } else if (requestId % 3 == 1) {\n            dataHelper.getStateByCode(\"CA\");\n        } else {\n            dataHelper.getLicenseClassByCode(\"CLASS_C\");\n        }\n        \n        return System.currentTimeMillis() - start;\n    });\n    futures.add(future);\n}\n\n// Collect results\nList<Long> times = new ArrayList<>();\nfor (Future<Long> future : futures) {\n    times.add(future.get());\n}\n\nexecutor.shutdown();\n\n// Calculate statistics\nlong totalTime = times.stream().mapToLong(Long::longValue).sum();\ndouble avgTime = totalTime / (double) times.size();\nlong minTime = times.stream().mapToLong(Long::longValue).min().orElse(0);\nlong maxTime = times.stream().mapToLong(Long::longValue).max().orElse(0);\n\nSystem.out.println(\"\\nPerformance test results (100 concurrent requests):\");\nSystem.out.println(\"  Average time: \" + String.format(\"%.2f\", avgTime) + \"ms\");\nSystem.out.println(\"  Min time: \" + minTime + \"ms\");\nSystem.out.println(\"  Max time: \" + maxTime + \"ms\");\nSystem.out.println(\"  Total time: \" + totalTime + \"ms\");\n\n// Final cache statistics\nCacheStatistics finalStats = externalDataService.getCacheStatistics();\nSystem.out.println(\"\\nFinal cache statistics:\");\nSystem.out.println(\"  Hit ratio: \" + String.format(\"%.2f%%\", finalStats.getOverallHitRatio() * 100));\nSystem.out.println(\"  Total requests: \" + (finalStats.getTotalHits() + finalStats.getTotalMisses()));\n```\n\n## Cleanup\n\n```java\n// Clean up resources\nif (executor != null && !executor.isShutdown()) {\n    executor.shutdown();\n}\n\nSystem.out.println(\"\\nJShell session complete. External data service examples finished.\");\n```\n\nThese examples demonstrate the full capabilities of the external data service, including basic queries, cache performance testing, and advanced usage patterns. Use them as a starting point for your own explorations and testing scenarios.\n"